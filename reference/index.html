
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../how-to-guides/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.0">
    
    
      
        <title>Reference - Matrix Synapse Automator</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.45e1311d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api_viewer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Matrix Synapse Automator" class="md-header__button md-logo" aria-label="Matrix Synapse Automator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Matrix Synapse Automator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Matrix Synapse Automator" class="md-nav__button md-logo" aria-label="Matrix Synapse Automator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Matrix Synapse Automator
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    matrix_synapse_automator_scripts
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#api_viewer" class="md-nav__link">
    <span class="md-ellipsis">
      api_viewer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper" class="md-nav__link">
    <span class="md-ellipsis">
      automation_helper
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.Callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Callbacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automation_helper.Callbacks.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation_helper.Callbacks.ai_message_callback" class="md-nav__link">
    <span class="md-ellipsis">
      ai_message_callback()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation_helper.Callbacks.invite_callback" class="md-nav__link">
    <span class="md-ellipsis">
      invite_callback()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation_helper.Callbacks.invite_display" class="md-nav__link">
    <span class="md-ellipsis">
      invite_display()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation_helper.Callbacks.invite_rejector" class="md-nav__link">
    <span class="md-ellipsis">
      invite_rejector()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.action_joined_members" class="md-nav__link">
    <span class="md-ellipsis">
      action_joined_members()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.action_joined_rooms" class="md-nav__link">
    <span class="md-ellipsis">
      action_joined_rooms()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.action_room_dm_create" class="md-nav__link">
    <span class="md-ellipsis">
      action_room_dm_create()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.is_ten_digits" class="md-nav__link">
    <span class="md-ellipsis">
      is_ten_digits()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.message_callback" class="md-nav__link">
    <span class="md-ellipsis">
      message_callback()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.return_room_members" class="md-nav__link">
    <span class="md-ellipsis">
      return_room_members()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-guides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to guides
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../explanation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explanation
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#api_viewer" class="md-nav__link">
    <span class="md-ellipsis">
      api_viewer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper" class="md-nav__link">
    <span class="md-ellipsis">
      automation_helper
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.Callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Callbacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automation_helper.Callbacks.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation_helper.Callbacks.ai_message_callback" class="md-nav__link">
    <span class="md-ellipsis">
      ai_message_callback()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation_helper.Callbacks.invite_callback" class="md-nav__link">
    <span class="md-ellipsis">
      invite_callback()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation_helper.Callbacks.invite_display" class="md-nav__link">
    <span class="md-ellipsis">
      invite_display()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation_helper.Callbacks.invite_rejector" class="md-nav__link">
    <span class="md-ellipsis">
      invite_rejector()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.action_joined_members" class="md-nav__link">
    <span class="md-ellipsis">
      action_joined_members()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.action_joined_rooms" class="md-nav__link">
    <span class="md-ellipsis">
      action_joined_rooms()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.action_room_dm_create" class="md-nav__link">
    <span class="md-ellipsis">
      action_room_dm_create()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.is_ten_digits" class="md-nav__link">
    <span class="md-ellipsis">
      is_ten_digits()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.message_callback" class="md-nav__link">
    <span class="md-ellipsis">
      message_callback()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation_helper.return_room_members" class="md-nav__link">
    <span class="md-ellipsis">
      return_room_members()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Reference</h1>

<p>This part of the documentation focuses 
on <strong>information oriented</strong> approach. It 
contains the details of the various scripts
of the <code>matrix_synapse_automator_scripts</code> project
code</p>


<div class="doc doc-object doc-module">



<a id="api_viewer"></a>
  <div class="doc doc-contents first">
  
      <p>Explores the objects created by the Matrix Nio framework by interacting
with your homeserver. </p>
<p>This modules acts as a playground before you start coding your logic or 
solve a automation challenge in your home server.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="automation_helper"></a>
  <div class="doc doc-contents first">
  
      <p>Provides several functions, classes with callback methods to
interact with your homeserver using python.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="automation_helper.Callbacks" class="doc doc-heading">
          <code>Callbacks</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>object</code></p>

  
      <p>Class initiated with the homeserver client which 
gives access to the callback methods, that uses the client 
to process the messages, invites.</p>

            <details class="quote">
              <summary>Source code in <code>automation_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Callbacks</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class initiated with the homeserver client which </span>
<span class="sd">    gives access to the callback methods, that uses the client </span>
<span class="sd">    to process the messages, invites.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store the AsyncClient&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">ai_message_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room</span><span class="p">:</span> <span class="n">MatrixRoom</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">RoomMessageText</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the AI generated reply for the messages recieved in the</span>
<span class="sd">        given room, with the send_text_message function</span>

<span class="sd">        Args:</span>
<span class="sd">            room: Matrix Room in which the AI model is linked</span>
<span class="sd">            event: Room event that contains the data sent by the server</span>

<span class="sd">        Returns:</span>
<span class="sd">            None&quot;&quot;&quot;</span>
        <span class="n">recieved_message</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">body</span>
        <span class="n">room_id</span> <span class="o">=</span> <span class="n">room</span><span class="o">.</span><span class="n">room_id</span>

        <span class="n">promptTemplate</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;You are helpful and pleasant assistant, who can process any message </span>
<span class="s2">        by thinking step by step. You are tasked to process the </span><span class="si">{message}</span><span class="s2">.</span>
<span class="s2">        Follows the instructions provided in the message and provide the reply.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">sender</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">user_id</span><span class="p">:</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">promptTemplate</span><span class="p">)</span>
            <span class="n">load_dotenv</span><span class="p">()</span>

            <span class="n">processor</span> <span class="o">=</span> <span class="n">prompt</span> <span class="o">|</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">openai_api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">))</span> <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">recieved_message</span><span class="p">})</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;room_id: </span><span class="si">{</span><span class="n">room_id</span><span class="si">}</span><span class="s2">, chatgpt: </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">await</span> <span class="n">send_text_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">,</span> <span class="n">room_id</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">invite_rejector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room</span><span class="p">:</span> <span class="n">MatrixRoom</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">InviteMemberEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rejects the invite recieved for a logged in user for the given </span>
<span class="sd">        room. </span>
<span class="sd">        Args:</span>
<span class="sd">            room: Matrix Room in which the AI model is linked</span>
<span class="sd">            event: Invite member Room event sent by the server</span>

<span class="sd">        Returns:</span>
<span class="sd">            None&quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*******Invite Rejection Start*********&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message callback from room </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="si">}</span><span class="s2"> recieved this.&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event Sender: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Display Name: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;displayname&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">membership</span> <span class="o">==</span> <span class="s2">&quot;invite&quot;</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Rejecting the invite membership event&quot;</span><span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">room_leave</span><span class="p">(</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rejected the room </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="si">}</span><span class="s2"> successfully.&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">invite_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room</span><span class="p">:</span><span class="n">MatrixRoom</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">InviteMemberEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rejects the invite recieved for a logged in user for the given </span>
<span class="sd">        room. </span>

<span class="sd">        Args:</span>
<span class="sd">            room: matrix room in which the ai model is linked</span>
<span class="sd">            event: invite member room event sent by the server</span>

<span class="sd">        Returns:</span>
<span class="sd">            none&quot;&quot;&quot;</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message callback from room </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="si">}</span><span class="s2"> recieved this.&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event Sender: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Display Name: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;displayname&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="k">async</span> <span class="k">def</span> <span class="nf">invite_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room</span><span class="p">:</span> <span class="n">MatrixRoom</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">InviteMemberEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rejects the invite recieved for a logged in user for the given </span>
<span class="sd">        room.</span>

<span class="sd">        Args:</span>
<span class="sd">            room: matrix room in which the ai model is linked</span>
<span class="sd">            event: invite member room event sent by the server</span>

<span class="sd">        Returns:</span>
<span class="sd">            None&quot;&quot;&quot;</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*******Invite Callback detail Start*********&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message callback from room </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="si">}</span><span class="s2"> recieved this.&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event Sender: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event shows membership: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">membership</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*******Invite Callback detail End*********&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">membership</span> <span class="o">==</span> <span class="s2">&quot;join&quot;</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Display Name: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;displayname&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># date objec</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;room_id_displayname_</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">.csv&quot;</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">membership</span> <span class="o">==</span> <span class="s2">&quot;invite&quot;</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing the invite membership event&quot;</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">is</span> <span class="n">JoinError</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error in Joining the Room&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Joined the room </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="si">}</span><span class="s2"> successfully.&quot;</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;+a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_obj</span><span class="p">:</span>
                    <span class="n">file_obj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;displayname&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="automation_helper.Callbacks.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">client</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Store the AsyncClient</p>

          <details class="quote">
            <summary>Source code in <code>automation_helper.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Store the AsyncClient&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="automation_helper.Callbacks.ai_message_callback" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">ai_message_callback</span><span class="p">(</span><span class="n">room</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns the AI generated reply for the messages recieved in the
given room, with the send_text_message function</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>room</code></td>
          <td>
                <code><span title="nio.MatrixRoom">MatrixRoom</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Matrix Room in which the AI model is linked</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>event</code></td>
          <td>
                <code><span title="nio.RoomMessageText">RoomMessageText</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Room event that contains the data sent by the server</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>automation_helper.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">ai_message_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room</span><span class="p">:</span> <span class="n">MatrixRoom</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">RoomMessageText</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the AI generated reply for the messages recieved in the</span>
<span class="sd">    given room, with the send_text_message function</span>

<span class="sd">    Args:</span>
<span class="sd">        room: Matrix Room in which the AI model is linked</span>
<span class="sd">        event: Room event that contains the data sent by the server</span>

<span class="sd">    Returns:</span>
<span class="sd">        None&quot;&quot;&quot;</span>
    <span class="n">recieved_message</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">body</span>
    <span class="n">room_id</span> <span class="o">=</span> <span class="n">room</span><span class="o">.</span><span class="n">room_id</span>

    <span class="n">promptTemplate</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;You are helpful and pleasant assistant, who can process any message </span>
<span class="s2">    by thinking step by step. You are tasked to process the </span><span class="si">{message}</span><span class="s2">.</span>
<span class="s2">    Follows the instructions provided in the message and provide the reply.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">sender</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">user_id</span><span class="p">:</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">promptTemplate</span><span class="p">)</span>
        <span class="n">load_dotenv</span><span class="p">()</span>

        <span class="n">processor</span> <span class="o">=</span> <span class="n">prompt</span> <span class="o">|</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">openai_api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">))</span> <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">recieved_message</span><span class="p">})</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;room_id: </span><span class="si">{</span><span class="n">room_id</span><span class="si">}</span><span class="s2">, chatgpt: </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">send_text_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">,</span> <span class="n">room_id</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="automation_helper.Callbacks.invite_callback" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">invite_callback</span><span class="p">(</span><span class="n">room</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Rejects the invite recieved for a logged in user for the given 
room.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>room</code></td>
          <td>
                <code><span title="nio.MatrixRoom">MatrixRoom</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>matrix room in which the ai model is linked</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>event</code></td>
          <td>
                <code><span title="nio.InviteMemberEvent">InviteMemberEvent</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>invite member room event sent by the server</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>automation_helper.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">invite_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room</span><span class="p">:</span> <span class="n">MatrixRoom</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">InviteMemberEvent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rejects the invite recieved for a logged in user for the given </span>
<span class="sd">    room.</span>

<span class="sd">    Args:</span>
<span class="sd">        room: matrix room in which the ai model is linked</span>
<span class="sd">        event: invite member room event sent by the server</span>

<span class="sd">    Returns:</span>
<span class="sd">        None&quot;&quot;&quot;</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*******Invite Callback detail Start*********&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message callback from room </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="si">}</span><span class="s2"> recieved this.&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event Sender: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event shows membership: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">membership</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*******Invite Callback detail End*********&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">membership</span> <span class="o">==</span> <span class="s2">&quot;join&quot;</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Display Name: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;displayname&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># date objec</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;room_id_displayname_</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">.csv&quot;</span>

    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">membership</span> <span class="o">==</span> <span class="s2">&quot;invite&quot;</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing the invite membership event&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">is</span> <span class="n">JoinError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error in Joining the Room&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Joined the room </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="si">}</span><span class="s2"> successfully.&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;+a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_obj</span><span class="p">:</span>
                <span class="n">file_obj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;displayname&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="automation_helper.Callbacks.invite_display" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">invite_display</span><span class="p">(</span><span class="n">room</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Rejects the invite recieved for a logged in user for the given 
room. </p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>room</code></td>
          <td>
                <code><span title="nio.MatrixRoom">MatrixRoom</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>matrix room in which the ai model is linked</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>event</code></td>
          <td>
                <code><span title="nio.InviteMemberEvent">InviteMemberEvent</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>invite member room event sent by the server</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>none</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>automation_helper.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">invite_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room</span><span class="p">:</span><span class="n">MatrixRoom</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">InviteMemberEvent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rejects the invite recieved for a logged in user for the given </span>
<span class="sd">    room. </span>

<span class="sd">    Args:</span>
<span class="sd">        room: matrix room in which the ai model is linked</span>
<span class="sd">        event: invite member room event sent by the server</span>

<span class="sd">    Returns:</span>
<span class="sd">        none&quot;&quot;&quot;</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message callback from room </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="si">}</span><span class="s2"> recieved this.&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event Sender: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Display Name: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;displayname&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="automation_helper.Callbacks.invite_rejector" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">invite_rejector</span><span class="p">(</span><span class="n">room</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Rejects the invite recieved for a logged in user for the given 
room. 
Args:
    room: Matrix Room in which the AI model is linked
    event: Invite member Room event sent by the server</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>automation_helper.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">invite_rejector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room</span><span class="p">:</span> <span class="n">MatrixRoom</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">InviteMemberEvent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rejects the invite recieved for a logged in user for the given </span>
<span class="sd">    room. </span>
<span class="sd">    Args:</span>
<span class="sd">        room: Matrix Room in which the AI model is linked</span>
<span class="sd">        event: Invite member Room event sent by the server</span>

<span class="sd">    Returns:</span>
<span class="sd">        None&quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*******Invite Rejection Start*********&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message callback from room </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="si">}</span><span class="s2"> recieved this.&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event Sender: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Display Name: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;displayname&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">membership</span> <span class="o">==</span> <span class="s2">&quot;invite&quot;</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Rejecting the invite membership event&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">room_leave</span><span class="p">(</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rejected the room </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="si">}</span><span class="s2"> successfully.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>



<div class="doc doc-object doc-function">




<h2 id="automation_helper.action_joined_members" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">action_joined_members</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">room</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return the members joined in a given room</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>client</code></td>
          <td>
                <code><span title="nio.AsyncClient">AsyncClient</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Roomserver client logged in using username and password</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>room</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Room_id in string format</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<span title="nio.RoomMember">RoomMember</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>String of member names invited into the room</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>automation_helper.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">action_joined_members</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">AsyncClient</span><span class="p">,</span> <span class="n">room</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">RoomMember</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the members joined in a given room</span>

<span class="sd">    Args:</span>
<span class="sd">        client: Roomserver client logged in using username and password</span>
<span class="sd">        room: Room_id in string format</span>

<span class="sd">    Returns:</span>
<span class="sd">        String of member names invited into the room&quot;&quot;&quot;</span>

    <span class="n">room</span> <span class="o">=</span> <span class="n">room</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\!&quot;</span><span class="p">,</span> <span class="s2">&quot;!&quot;</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">joined_members</span><span class="p">(</span><span class="n">room</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">JoinedMembersError</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Joined members failed with </span><span class="si">{</span><span class="n">resp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">room_id</span>
    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">members</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;;&quot;</span> <span class="o">+</span> <span class="n">member</span><span class="o">.</span><span class="n">user_id</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
                <span class="o">+</span> <span class="n">member</span><span class="o">.</span><span class="n">display_name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="automation_helper.action_joined_rooms" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">action_joined_rooms</span><span class="p">(</span><span class="n">client</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return the list of rooms joined by the user logged into the Client</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>client</code></td>
          <td>
                <code><span title="nio.AsyncClient">AsyncClient</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Roomserver client logged in using username and password</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<span title="nio.MatrixRoom">MatrixRoom</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of room_id in which the user is part of.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>automation_helper.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">action_joined_rooms</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">AsyncClient</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">MatrixRoom</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the list of rooms joined by the user logged into the Client</span>

<span class="sd">    Args:</span>
<span class="sd">        client: Roomserver client logged in using username and password</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of room_id in which the user is part of.&quot;&quot;&quot;</span>

    <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">joined_rooms</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">JoinedRoomsError</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Joined rooms failed with </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Joined rooms success with </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">rooms</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="automation_helper.action_room_dm_create" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">action_room_dm_create</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">tgt_user</span><span class="p">,</span> <span class="n">roomAlias</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">topic</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Create a direct message (DM) room while already being logged in.
After creating the private DM room it invites the other user to it.
Purpose of the script is to send invites from the command line,
where the client is already logged in using the user_name, who is sending the dm.
Name of the room is created using random numbers, so the existing
room conflicts are avoided.
Args:
    client: AsyncClient: nio client, allows as to query the server
    credentials: dict: allows to get the user_id of sender, etc
    user : User to create DM rooms with
Returns:
    None</p>

          <details class="quote">
            <summary>Source code in <code>automation_helper.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">action_room_dm_create</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">AsyncClient</span><span class="p">,</span> <span class="n">tgt_user</span><span class="p">,</span> <span class="n">roomAlias</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">topic</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a direct message (DM) room while already being logged in.</span>
<span class="sd">    After creating the private DM room it invites the other user to it.</span>
<span class="sd">    Purpose of the script is to send invites from the command line,</span>
<span class="sd">    where the client is already logged in using the user_name, who is sending the dm.</span>
<span class="sd">    Name of the room is created using random numbers, so the existing</span>
<span class="sd">    room conflicts are avoided.</span>
<span class="sd">    Args:</span>
<span class="sd">        client: AsyncClient: nio client, allows as to query the server</span>
<span class="sd">        credentials: dict: allows to get the user_id of sender, etc</span>
<span class="sd">        user : User to create DM rooms with</span>
<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># room_aliases: Created with {user_name}_{uuid}_{date}</span>
    <span class="c1"># topic : {user_name}_topic_discussion_{uuid}</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
         <span class="sa">f</span><span class="s1">&#39;Creating DM room with user &quot;</span><span class="si">{</span><span class="n">tgt_user</span><span class="si">}</span><span class="s1">&quot;, &#39;</span>
         <span class="sa">f</span><span class="s1">&#39;room alias &quot;</span><span class="si">{</span><span class="n">roomAlias</span><span class="si">}</span><span class="s1">&quot;, &#39;</span>
         <span class="sa">f</span><span class="s1">&#39;name &quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;, topic &quot;</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s1">&quot; and &#39;</span>
     <span class="p">)</span>

    <span class="c1"># nio&#39;s room_create does NOT accept &quot;#foo:example.com&quot;</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">room_create</span><span class="p">(</span>
         <span class="n">alias</span><span class="o">=</span><span class="n">roomAlias</span><span class="p">,</span>  <span class="c1"># desired canonical alias local part, e.g. foo</span>
         <span class="n">visibility</span><span class="o">=</span><span class="n">RoomVisibility</span><span class="o">.</span><span class="n">private</span><span class="p">,</span>
         <span class="n">is_direct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
         <span class="n">preset</span><span class="o">=</span><span class="n">RoomPreset</span><span class="o">.</span><span class="n">private_chat</span><span class="p">,</span>
         <span class="n">invite</span><span class="o">=</span><span class="p">{</span><span class="n">tgt_user</span><span class="p">},</span>  <span class="c1"># invite the user to the DM</span>
         <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>  <span class="c1"># room name</span>
         <span class="n">topic</span><span class="o">=</span><span class="n">topic</span><span class="p">,</span>  <span class="c1"># room topic</span>
         <span class="n">initial_state</span><span class="o">=</span><span class="p">())</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">RoomCreateError</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
             <span class="s2">&quot;E125: &quot;</span>
             <span class="s2">&quot;Room_create failed with response: &quot;</span>
             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
         <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invite to </span><span class="si">{</span><span class="n">tgt_user</span><span class="si">}</span><span class="s2"> succeeded&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="automation_helper.is_ten_digits" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">is_ten_digits</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Checks if a string contains ten numbers only.
Args:
  string: The string to check.
Returns:
  True if the string contains ten numbers only, False otherwise.</p>

          <details class="quote">
            <summary>Source code in <code>automation_helper.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_ten_digits</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if a string contains ten numbers only.</span>
<span class="sd">    Args:</span>
<span class="sd">      string: The string to check.</span>
<span class="sd">    Returns:</span>
<span class="sd">      True if the string contains ten numbers only, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
        <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">string</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="automation_helper.message_callback" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">message_callback</span><span class="p">(</span><span class="n">room</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Callback that processes the messages recieved inside the Matrix room </p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>room</code></td>
          <td>
                <code><span title="nio.MatrixRoom">MatrixRoom</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Matrix room from which the message event has to be processed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>event</code></td>
          <td>
                <code><span title="nio.RoomMessageText">RoomMessageText</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of room_ids as strings.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Appends the room_id, event_id, room display_name, event timestamp, and</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
                <code>None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>event body to the text file, that is named with the date of processing.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>automation_helper.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">message_callback</span><span class="p">(</span><span class="n">room</span><span class="p">:</span> <span class="n">MatrixRoom</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">RoomMessageText</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Callback that processes the messages recieved inside the Matrix room </span>

<span class="sd">    Args:</span>
<span class="sd">        room: Matrix room from which the message event has to be processed.</span>
<span class="sd">        event: List of room_ids as strings.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Appends the room_id, event_id, room display_name, event timestamp, and</span>
<span class="sd">        event body to the text file, that is named with the date of processing.&quot;&quot;&quot;</span>


    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Message received in room </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">display_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># unix ts is converted to datetime instance, and the formatted to string format, that is required by us</span>
        <span class="c1"># divide the ts with 1000 to make it as seconds</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">user_name</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">body</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">server_timestamp</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># date objec</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;message_collector_</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">.txt&quot;</span>
    <span class="c1"># Writing the messages to the file</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;a+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">msg_fobj</span><span class="p">:</span>
        <span class="n">msg_fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">room_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">event_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">display_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">server_timestamp</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">room</span><span class="o">.</span><span class="n">user_name</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">body</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="automation_helper.return_room_members" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">return_room_members</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">rooms_list</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Extracts the members of multiple rooms </p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>client</code></td>
          <td>
                <code><span title="nio.AsyncClient">AsyncClient</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Roomserver client logged in using username and password.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>rooms_list</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of room_ids as strings.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<span title="automation_helper.room_members">room_members</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of dictionaries of room and its joined members</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>automation_helper.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">return_room_members</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">AsyncClient</span><span class="p">,</span> <span class="n">rooms_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">room_members</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts the members of multiple rooms </span>

<span class="sd">    Args:</span>
<span class="sd">        client: Roomserver client logged in using username and password.</span>
<span class="sd">        rooms_list: List of room_ids as strings.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of dictionaries of room and its joined members&quot;&quot;&quot;</span>

    <span class="n">room_members</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">room</span> <span class="ow">in</span> <span class="n">rooms_list</span><span class="p">:</span>

        <span class="n">joined_members</span> <span class="o">=</span> <span class="k">await</span> <span class="n">action_joined_members</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">room</span><span class="p">)</span>

        <span class="n">room_members</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">room</span><span class="p">:</span> <span class="n">joined_members</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">room_members</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>